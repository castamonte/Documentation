# Центр сертификации

Учётная запись без пароля? Сертификат для меня? Вы представляете, что Zeronet не соответствует соглашениям. В этом разделе Вы узнаете как работают сертификаты пользователей и центр сертификации в Zeronet.

## Что делает центр сертификации

В ZeroNet всё подписано ключами биткойн. Сертификат обеспечивает уникальное и запоминающееся имя для адреса биткойн. Центр сертификации (или провайдер ID) ответственен за доказательство соответствия между уникальным именем и адресом биткойн.

## Формат сертификата

### Тело

Тело сертификата содержит адрес биткойн, тип портала и запоминающееся имя пользователя.

```
[BitcoinAddress]#[PortalType]/[UserName]
```

**Пример:**

```
1H28iygiKXe3GUMcD77HiifVqtf3858Aft#web/hellozeronet
```

- Адрес Bitcoin: `1H28iygiKXe3GUMcD77HiifVqtf3858Aft`
- Тип портала: `web`
- Имя пользователя: `hellozeronet`

**Основные правила:**

Адрес Bitcoin, тип портала и имя пользователя **не должны** содержать символы `#`, `@` или `/`

Только 0-9 и a-z допустимы в имени пользователя. Все английские буквы в имени пользователя должны быть в нижнем регистре. Имя пользователя **не должно** быть слишком длинным. Имя пользователя **должно** быть разборчивым и **не должно** мешать отображению пользовательского интерфейса.

Имя пользователя **должно** быть уникальным в множестве всех зарегистрированных имён пользователей.

### Подпись

Алгоритм подписи сертификата загружает секретный ключ подписи генерирует детерминированную биткойн-подпись для тела сертификата.

**Из исходных текстов:**

```python
sign = os.popen("python zeronet.py --debug cryptSign %s#bitmsg/%s %s 2>&1" % (auth_address, user_name, config.site_privatekey)).readlines()[-1].strip()
```

### Сертификат

Глядя в исходные коды ZeroID, мы знаем как сертификат хранится в его публичной базе данных.

```python
data["users"][user_name] = "bitmsg,%s,%s" % (auth_address, sign)
```

**Пример:**

```
"hellozeronet": "web,1H28iygiKXe3GUMcD77HiifVqtf3858Aft,HA2A+iKekECD3hasrsN8IrR86BnXQ63kPH+9A85JLO9hLUpRJTBn62UfnuuF92B9CIc6+EewAIqzIn9UoVq2LPA="
```
Сертификат может быть сохранён в различных форматах. Тем не менее, все форматы должны содержать:

- Адрес Bitcoin: `1H28iygiKXe3GUMcD77HiifVqtf3858Aft`
- Тип портала: `web`
- Имя пользователя: `hellozeronet`
- Подпись центра сертификации: `HA2A+iKekECD3hasrsN8IrR86BnXQ63kPH+9A85JLO9hLUpRJTBn62UfnuuF92B9CIc6+EewAIqzIn9UoVq2LPA=`

## Использование в `content.json`

Владелец сайта может выбирать, каким центрам сертификации доверять.

Blue Hub, например, принимает сертификаты, подписанные ZeroID. Это правило определено в его `data/users/content.json`

- Читаемое имя провайдера ID: `zeroid.bit`
- Отпечаток открытого ключа провайдера ID: `1iD5ZQJMNXu43w1qLB8sfdHVKppVMduGz`

```json
"user_contents": {
  "cert_signers": {
   "zeroid.bit": [
    "1iD5ZQJMNXu43w1qLB8sfdHVKppVMduGz"
   ]
  }
}
```

Каждый пользователь предоставляет свой сертификат в файле манифеста в своём каталоге Bitcoin. Например, `data/users/1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj/content.json` содержит:

```json
{
 "address": "1BLueGvui1GdbtsjcKqCf4F67uKfritG49",
 "cert_auth_type": "web",
 "cert_sign": "HPiZsWEJ5eLnspUj8nQ75WXbSanLz0YhQf5KJDq+4bWe6wNW98Vv9PXNyPDNu2VX4bCEXhRC65pS3CM7cOrjjik=",
 "cert_user_id": "nofish@zeroid.bit",
 "files": {
  "data.json": {
   "sha512": "8e597412a2bc2726ac9a1ee85428fb3a94b09f4e7a3f5f589119973231417b15",
   "size": 21422
  }
 },
 "inner_path": "data/users/1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj/content.json",
 "modified": 1492458379,
 "signs": {
  "1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj": "G8kaZIGAstsiWLVY20e2ogJQi4OO+QuwqJ9GTj3gz7YleST/jst7RQH7hDn0uf8BJMBjFs35H3LPhNHHj4jueh8="
 }
}
```

Относится к сайту:

- Ожидаемый URL сайта: `"address": "1BLueGvui1GdbtsjcKqCf4F67uKfritG49"`
- Ожидаемый путь файла: `"inner_path": "data/users/1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj/content.json"`

Информация сертификата:
Certificate information:

- Провайдер ID: `zeroid.bit`
- Имя пользователя: `nofish`
- Bitcoin адрес пользователя: `1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj`
- Тип портала: `web`
- Подпись провайдера ID: `HPiZsWEJ5eLnspUj8nQ75WXbSanLz0YhQf5KJDq+4bWe6wNW98Vv9PXNyPDNu2VX4bCEXhRC65pS3CM7cOrjjik=`

### Процесс проверки

1. Алгоритм проверки читает `data/users/content.json` чтобы определить нужный сайт для контента пользователя.

2. Алгоритм проверки читает `data/users/content.json` чтобы найти отпечаток публичного ключа провайдера ID.

3. Получив биткойн-адрес, тип портала и имя пользователя, алгоритм проверки восстанавливает тело сертификата.

4. Алгоритм проверки проверяет подпись провайдера ID с публичным ключом определённым в `data/users/content.json`, чтобы гарантировать подлинность тела сертификата.

5. Алгоритм проверки загружает публичный ключ пользователя и проверяет подлинность пользовательского контанта.

## Функции и ограничения центров сертификации

- Центр сертификации предоставляет запоминающиеся имена для отпечатков пользовательских публичных ключей. Это также помогает уменьшить спам и нежелательный контент.

- Пользователь не должен выдавать секретную информацию, такую как пароли. К тому же, пользователь должен аутентифицироваться только единожды.

- Центр сертификации не должен быть одобрен разработчиками ZeroNet. Владелец сайта может выбирать какому центру сертификации доверять ради качества пользовательского контента.

- Центр сертификации ответственен за поддержку пула своих пользователей.

- ZeroID не отзывает и не обновляет сертификаты.

## Могу я жить без центров сертификации?

В основном сертификаты требуются, когда Вы добавляете что-либо на чей-то сайт. Вам не нужен сертификат для изменения собственного сайта.
